# Template Registry Seeding

## What the seeds do

- **Prod seed**: Inserts or updates only the **3 core templates** (Residential Modern v1, Corporate Property Manager v1, Luxury Lifestyle v1). Idempotent: it does not overwrite existing template structure or config; it only fills missing fields (e.g. `thumbnail_url`, `preview_url`, `is_recommended`). Safe for production.

- **Demo seed**: Inserts or updates **all 12 templates** (10 v1 + 2 v2). Richer set for demos and local development. With `SEED_FORCE=true`, existing templates can be overwritten to match the catalog (demo only).

- **Demo dataset**: Templates store a `demo_dataset_key` (e.g. `pmc_default_v1`) in `default_config_json`. The full JSON dataset is **not** stored in the DB; it is generated by the seeding helpers and served via the API for preview rendering.

## How to run

From the **backend** directory:

```bash
# Demo (all 12 templates, optional overwrite with SEED_FORCE)
python -m scripts.seed.seed_all_demo

# Prod (3 core templates only, idempotent)
python -m scripts.seed.seed_all_prod
```

Or run the template-only scripts:

```bash
python -m scripts.seed.seed_templates_demo
python -m scripts.seed.seed_templates_prod
```

## SEED_FORCE (demo only)

- `SEED_FORCE=true`: When running **demo** seed, existing templates are updated to match the catalog (including structure and config). Use for resetting demo data.
- Omitted or `false`: Existing templates are only updated with non-destructive fields (e.g. thumbnails, preview URLs, recommendations).
- **Prod seed always ignores SEED_FORCE** and never overwrites structure.

## Placeholder preview URLs

- Preview URL: `https://example.com/previews/<slug>-v<version>`
- Thumbnails: `https://placehold.co/600x400?text=<name>`

The app provides preview via **POST /api/templates/{id}/generate-preview** and **GET /api/templates/{id}/preview**. Replace placeholder URLs with your real preview infrastructure (e.g. a preview service that renders templates with the demo dataset). The API `GET /api/templates/demo-dataset?key=pmc_default_v1` returns the JSON dataset so a future preview renderer can fetch it and render templates with “real” content.

## Uniqueness and default

- Templates are keyed by **slug + version**. Only one template per `(slug, version)`.
- After seeding, **exactly one** template is marked default: **Residential Modern v1** (`slug=residential-modern`, `version=1`). Any other `is_default` is cleared.

## Demo dataset API

- **GET /api/templates/demo-dataset?key=pmc_default_v1**  
  Returns the full demo JSON (brand, company, property, amenities, gallery, floor plans, testimonials, FAQs, policies, social links, locations). Admin/manager only.
